import "@k8s/api/apps/v1/Deployment.pkl"
import "@k8s/api/core/v1/PodSpec.pkl"
import "@k8s/K8sResource.pkl"

name: String
namespace: String = "default"
spec: PodSpec
type: "Deployment" = "Deployment"

local moduleThis = this

deployment: Deployment = new Deployment {
  metadata {
    name = moduleThis.name
    namespace = moduleThis.namespace
    labels {
      ["app"] = moduleThis.name
    }
  }
  spec {
    selector {
      matchLabels {
        ["app"] = moduleThis.name
      }
    }
    template {
      metadata {
        labels {
          ["app"] = moduleThis.name
        }
      }
      spec = moduleThis.spec
    }
  }
}

resources: Listing<K8sResource> = new {
  when (type == "Deployment") {
    moduleThis.deployment
  }
}
